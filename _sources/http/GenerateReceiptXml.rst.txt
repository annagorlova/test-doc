GenerateReceiptXml
==========================

Обобщённый метод генерации извещений о получении (далее — ИоП) на различные сущности в системе.

.. http:post:: /GenerateReceiptXml

    :query boxId: идентификатор ящика
    :query messageId: идентификатор сообщения
    :query attachmentId: идентификатор :doc:`сущности <../proto/Entity message>`, для которой требуется сформировать ИоП

    :reqheader Authorization: данные, необходимые для :doc:`авторизации <../Authorization>`

    :statuscode 200: операция успешно завершена
    :statuscode 400: данные в запросе имеют неверный формат или отсутствуют обязательные параметры
    :statuscode 401: в запросе отсутствует HTTP-заголовок ``Authorization``, или в этом заголовке содержатся некорректные авторизационные данные
    :statuscode 403: доступ к ящику с предоставленным авторизационным токеном запрещен
    :statuscode 405: используется неподходящий HTTP-метод
    :statuscode 409: формирование ИоПа для данной сущности невозможно
    :statuscode 500: при обработке запроса возникла непредвиденная ошибка


В теле запроса должны содержаться данные о подписанте генерируемого извещения в виде сериализованной структуры :doc:`../proto/Signer`.

В теле ответа содержится XML-файл ИоПа для сущности ``attachmentId`` из сообщения ``messageId`` в ящике ``boxId``. На текущий момент в Диадоке можно отправлять ИоПы на следующие сущности:

.. csv-table::
    :header: "Тип ИоПа", "AttachmentType соответствующей сущности", "Кто шлёт ИоП", "Кто получает ИоП"
    :widths: 10, 10, 10, 10

    "На титул отправителя", "Title (или старый точечный титул отправителя)", "Получатель документа", "Отправитель документа"
    "На титул получателя", "Title (или старый точечный титул получателя)", "Отправитель", "Получатель"
	"На уведомление об уточнении", "InvoiceCorrectionRequest", "Отправитель", "Получатель"

Для каждого типа документа возможность отправки ИоП задается в свойствах :doc:`workflow <../proto/DocumentWorkflow>` документа: свойства «Извещение о получении титула отправителя», «Извещение о получении титула получателя», «Ответное действие на уведомление об уточнении».


Файл с извещением формируется в соответствии с `XML-схемой <https://diadoc.kontur.ru/sdk/xsd/DP_IZVPOL_1_982_00_01_01_02.xsd>`__. Имя файла с извещением передается в стандартном HTTP-заголовке ``Content-Disposition``.


После успешной генерации файла его можно загрузить в систему, передав в методе :doc:`../http/PostMessagePatch` в структуре ``Receipts``.

.. warning:: Методы ``GenerateDocumentReceiptXml`` и ``GenerateInvoiceDocumentReceiptXml`` расширены и поддерживают весь функционал нового метода, но считаются устаревшими и не рекомендуются к использованию.



